#nrow(subset(sqft_compare, sqft_living == sqft_above))
train <- mutate(train, price_log10 <- log10(train$price))
train <- mutate(train, price_sqrt <- sqrt(train$price))
train <- mutate(train, price_inv <- 1/(train$price))
p1 <- ggplot(train, aes(x=price)) + geom_histogram(aes(y=..density..), colour = "navy", fill = "steelblue", bins=30) + geom_density(colour = "goldenrod1", size = 1)
p2 <- ggplot(train, aes(x=price_log10 <- log10(train$price))) + geom_histogram(aes(y=..density..), colour = "navy", fill = "steelblue", bins=30) + geom_density(colour = "goldenrod1", size = 1)
p3 <- ggplot(train, aes(x=price_sqrt <- sqrt(train$price))) + geom_histogram(aes(y=..density..), colour = "navy", fill = "steelblue", bins=30) + geom_density(colour = "goldenrod1", size = 1)
p4 <- ggplot(train, aes(x=price_inv <- 1/(train$price))) + geom_histogram(aes(y=..density..), colour = "navy", fill = "steelblue", bins=30) + geom_density(colour = "goldenrod1", size = 1)
grid.arrange(p1, p2, p3, p4, nrow=2)
qqnorm(train$price)
qqline(train$price)
qqnorm(train$price_log10 <- log10(train$price))
qqline(train$price_log10 <- log10(train$price))
#Tranfomación de variables
train$waterfront = as.factor(train$waterfront)
train$view = as.factor(train$view)
train$zipcode = as.factor(train$zipcode)
#Creamos una variable que mide la distnacia de cada casa a la venta con respecto al centro ecónomico de la ciudad: Seattle
seattle = c(-122.335167, 47.608013)
train = mutate(train, Dist_from_seattle=distHaversine(cbind(long, lat),seattle))
#POr otro lado, se calcula la distancia de cada casa con respecto al resto, agrupando después casas cercanas en clústers.
long= train$long
lat = train$lat
DataMat<-as.matrix(cbind(long, lat))
DataMat[is.na(DataMat)]<-0
my_data <- as_tibble(DataMat)
#my_data=my_data %>% slice(1:100)
my_data = as.data.frame(my_data)
#<-distm(my_data,my_data,fun=distHaversine)/1000
#hclustfunc <- function(x) hclust(x, method="complete")
#distfunc <- function(x) as.dist((1-cor(t(x)))/2)
#d <- distfunc(Dist_Mat)
#fit <- hclustfunc(d)
#my_data$Clusters<- cutree(fit, h=0.25)
#train = merge(x = train, y = my_data, by = c("lat", "long") , all.x = TRUE)
#train$Clusters = as.factor(train$Clusters)
#bwplot(Clusters~price, data = train, horizontal= TRUE)
#specify_decimal
specify_decimal <- function(x, k) format(round(x, k), nsmall=k)
#beautifying summary.lm
new_summary  <- function(lmcoef, digits) {
coefs <- as.data.frame(lmcoef)
coefs[] <- lapply(coefs, function(x) specify_decimal(x, digits))
coefs
}
#(train, file = "C:/Users/Moncef/Documents/house_king_county/train.csv")
#Convertimos las variables catageoricas en dummies para su uso en el modelo.
# train_v1<- dummy_cols(train, select_columns = c('waterfront','view','Clusters','sale_quarter'),remove_most_frequent_dummy = TRUE,
#                    remove_selected_columns = TRUE)
#
# train_v1$sqft_lot_log = log(train_v1$sqft_lot)
# train_v1$sqft_above_log = log(train_v1$sqft_above)
# train_v1$sqft_living_log = log(train_v1$sqft_living)
# train_v1$Dist_from_seattle_log = log(train_v1$Dist_from_seattle)
# #train_v1$yr_renovated_log = log(train_v1$yr_renovated)
# #train_v1$sale_tenure_log = log(train_v1$sale_tenure)
#
#
# #Incluimos en c() las variables que NO queremos usar en la regresión.
# train_v2 = dplyr::select(train_v1,-c(id,sale_tenure,yr_renovated,sqft_above,sqft_lot,sale_tenure,yr_renovated,sqft_living,Dist_from_seattle,price,date,zipcode,sqft_basement,lat,sqft_lot15,long,date,sale_date,
#                               sale_year,yr_built,sale_month,yr_since_last_renovated,sqft_living15))
#
# summarize(train_v2)
#
# model <- lm(log(price_m2) ~ ., data = train_v2)
# summary(model)
# new_summary(summary(model)$coefficients, 5)
#
# plot(model, 1)
# res <- resid(model)
# plot(fitted(model), res)
# plot(model, which=1, col=c("blue"))
# plot(model, 2)
#
# require(nortest)  # Se debe haber instalado nortest
# lillie.test(model$residuals)
#Analisis de variables candidatas
step_model <- stepAIC(model, trace = TRUE, direction= "both")
am_cuant <- train %>% select("price","price_m2", "sqft_living","sqft_lot", "sqft_above", "sqft_basement", "yr_built", "yr_renovated", "lat", "long", "sqft_living15", "sqft_lot15")
amc1 <- c("sqft_living", "sqft_lot", "sqft_living15", "price", "sqft_basement", "sqft_above")
amc2 <- c("yr_built", "yr_renovated", "price")
#Correlación numérica entre variables
corr <- am_cuant %>% na.omit() %>% cor()
#Correlaciones importantes
as.data.frame(as.table(corr)) %>% subset(., abs(Freq) > 0.4) %>% subset(., abs(Freq) != 1) %>% .[order(.$Freq, decreasing = TRUE),] %>%
.[c(seq(1, nrow(.), by=2)),]
am_cuant <- train %>% select("price","Dist_from_seattle","price_m2", "sqft_living","sqft_lot", "sqft_above", "sqft_basement", "yr_built", "yr_renovated", "lat", "long", "sqft_living15", "sqft_lot15")
amc1 <- c("sqft_living", "sqft_lot", "sqft_living15", "sqft_basement", "sqft_above","price","price_m2","Dist_from_seattle")
amc2 <- c("yr_built", "yr_renovated", "price")
#Correlación numérica entre variables
corr <- am_cuant %>% na.omit() %>% cor()
#Correlaciones importantes
as.data.frame(as.table(corr)) %>% subset(., abs(Freq) > 0.4) %>% subset(., abs(Freq) != 1) %>% .[order(.$Freq, decreasing = TRUE),] %>%
.[c(seq(1, nrow(.), by=2)),]
am_cuant <- train %>% select("price","Dist_from_seattle","price_m2", "sale_date", "sale_year", "sale_month", "sqft_living","sqft_lot", "sqft_above", "sqft_basement", "yr_built", "yr_renovated", "lat", "long", "sqft_living15", "sqft_lot15")
amc1 <- c("sqft_living", "sqft_lot", "sqft_living15", "sqft_basement", "sqft_above","price","price_m2","Dist_from_seattle", "sale_date", "sale_year", "sale_month")
amc2 <- c("yr_built", "yr_renovated", "price")
#Correlación numérica entre variables
corr <- am_cuant %>% na.omit() %>% cor()
#Correlaciones importantes
as.data.frame(as.table(corr)) %>% subset(., abs(Freq) > 0.4) %>% subset(., abs(Freq) != 1) %>% .[order(.$Freq, decreasing = TRUE),] %>%
.[c(seq(1, nrow(.), by=2)),]
am_cual <- train %>% select("date","sale_date", "sale_year", "sale_month", "bedrooms", "bathrooms", "waterfront", "view", "condition", "grade", "zipcode")
am1 <- c("bedrooms", "bathrooms","condition","grade","sale_date", "sale_year", "sale_month")
#Correlación numérica entre variables
corr <- am_cual %>% select(am1) %>% na.omit() %>% cor()
#Correlaciones importantes
as.data.frame(as.table(corr)) %>% subset(., abs(Freq) > 0.1) %>% subset(., abs(Freq) != 1) %>% .[order(.$Freq, decreasing = TRUE),] %>%
.[c(seq(1, nrow(.), by=2)),]
am_cual <- train %>% select("date","sale_date", "sale_year", "sale_month", "bedrooms", "bathrooms", "waterfront", "view", "condition", "grade", "zipcode")
am1 <- c("bedrooms", "bathrooms","condition","grade","sale_date", "sale_year", "sale_month")
#Correlación numérica entre variables
corr <- am_cual %>% select(am1) %>% na.omit() %>% cor()
#Correlaciones importantes
as.data.frame(as.table(corr)) %>% subset(., abs(Freq) > 0.1) %>% subset(., abs(Freq) != 1) %>% .[order(.$Freq, decreasing = TRUE),] %>%
.[c(seq(1, nrow(.), by=7)),]
am_cual <- train %>% select("date","sale_date", "sale_year", "sale_month", "bedrooms", "bathrooms", "waterfront", "view", "condition", "grade", "zipcode")
am1 <- c("bedrooms", "bathrooms","condition","grade","sale_date", "sale_year", "sale_month")
#Correlación numérica entre variables
corr <- am_cual %>% select(am1) %>% na.omit() %>% cor()
#Correlaciones importantes
as.data.frame(as.table(corr)) %>% subset(., abs(Freq) > 0.1) %>% subset(., abs(Freq) != 1) %>% .[order(.$Freq, decreasing = TRUE),] %>%
.[c(seq(1, nrow(.), by=8)),]
am_cual <- train %>% select("date","sale_date", "sale_year", "sale_month", "bedrooms", "bathrooms", "waterfront", "view", "condition", "grade", "zipcode")
am1 <- c("bedrooms", "bathrooms","condition","grade","sale_date", "sale_year", "sale_month")
#Correlación numérica entre variables
corr <- am_cual %>% select(am1) %>% na.omit() %>% cor()
#Correlaciones importantes
as.data.frame(as.table(corr)) %>% subset(., abs(Freq) > 0.1) %>% subset(., abs(Freq) != 1) %>% .[order(.$Freq, decreasing = TRUE),] %>%
.[c(seq(1, nrow(.), by=1)),]
am_cual <- train %>% select("date","sale_date", "sale_year", "sale_month", "bedrooms", "bathrooms", "waterfront", "view", "condition", "grade", "zipcode")
am1 <- c("bedrooms", "bathrooms","condition","grade","sale_date", "sale_year", "sale_month")
#Correlación numérica entre variables
corr <- am_cual %>% select(am1) %>% na.omit() %>% cor()
#Correlaciones importantes
as.data.frame(as.table(corr)) %>% subset(., abs(Freq) > 0.1) %>% subset(., abs(Freq) != 1) %>% .[order(.$Freq, decreasing = TRUE),] %>%
.[c(seq(1, nrow(.), by=9)),]
am_cuant <- train %>% select("price","Dist_from_seattle","price_m2", "sqft_living","sqft_lot", "sqft_above", "sqft_basement", "yr_built", "yr_renovated", "lat", "long", "sqft_living15", "sqft_lot15")
amc1 <- c("sqft_living", "sqft_lot", "sqft_living15", "sqft_basement", "sqft_above","price","price_m2","Dist_from_seattle")
amc2 <- c("yr_built", "yr_renovated", "price")
#Correlación numérica entre variables
corr <- am_cuant %>% na.omit() %>% cor()
#Correlaciones importantes
as.data.frame(as.table(corr)) %>% subset(., abs(Freq) > 0.4) %>% subset(., abs(Freq) != 1) %>% .[order(.$Freq, decreasing = TRUE),] %>%
.[c(seq(1, nrow(.), by=2)),]
am_cual <- train %>% select("date","sale_date", "sale_year", "sale_month", "bedrooms", "bathrooms", "waterfront", "view", "condition", "grade", "zipcode")
am1 <- c("date","sale_date", "sale_year","bedrooms", "bathrooms","condition","grade")
#Correlación numérica entre variables
corr <- am_cual %>% select(am1) %>% na.omit() %>% cor()
#Correlaciones importantes
as.data.frame(as.table(corr)) %>% subset(., abs(Freq) > 0.1) %>% subset(., abs(Freq) != 1) %>% .[order(.$Freq, decreasing = TRUE),] %>%
.[c(seq(1, nrow(.), by=2)),]
am_cual <- train %>% select("date","sale_date", "sale_year", "sale_month", "bedrooms", "bathrooms", "waterfront", "view", "condition", "grade", "zipcode")
am1 <- c("date","sale_date", "sale_year","sale_month","bedrooms", "bathrooms","condition","grade")
#Correlación numérica entre variables
corr <- am_cual %>% select(am1) %>% na.omit() %>% cor()
#Correlaciones importantes
as.data.frame(as.table(corr)) %>% subset(., abs(Freq) > 0.1) %>% subset(., abs(Freq) != 1) %>% .[order(.$Freq, decreasing = TRUE),] %>%
.[c(seq(1, nrow(.), by=2)),]
am_cual <- train %>% select("bedrooms", "bathrooms", "waterfront", "view", "condition", "grade", "zipcode")
am1 <- c("bedrooms", "bathrooms","condition","grade")
#Correlación numérica entre variables
corr <- am_cual %>% select(am1) %>% na.omit() %>% cor()
#Correlaciones importantes
as.data.frame(as.table(corr)) %>% subset(., abs(Freq) > 0.1) %>% subset(., abs(Freq) != 1) %>% .[order(.$Freq, decreasing = TRUE),] %>%
.[c(seq(1, nrow(.), by=2)),]
am_cual <- train %>% select("date","sale_date", "sale_year", "sale_month", "bedrooms", "bathrooms", "waterfront", "view", "condition", "grade", "zipcode")
am1 <- c("bedrooms", "bathrooms","condition","grade")
#Correlación numérica entre variables
corr <- am_cual %>% select(am1) %>% na.omit() %>% cor()
#Correlaciones importantes
as.data.frame(as.table(corr)) %>% subset(., abs(Freq) > 0.1) %>% subset(., abs(Freq) != 1) %>% .[order(.$Freq, decreasing = TRUE),] %>%
.[c(seq(1, nrow(.), by=2)),]
install.packages("date")
install.packages("date")
#Librerias
library(tidyr)
library(date)
library(zoo)
#library(tidyverse)
library(ggplot2)
library(corrplot)
library(caret)
library(dplyr)
library(olsrr)
library(fastDummies)
library(pracma)
library(geosphere)
library(readxl)
library(glmnet)
library(readr)
library(naniar)
library(gridExtra)
library(grid)
library(lattice)
library(GGally)
var_cuant <- train[, c(3, 6, 20, 7, 21, 13, 14, 15, 16)]
str(var_cuant)
p1 <- ggplot(train, aes(x=price)) + geom_histogram(aes(y=..density..), colour = "navy", fill = "steelblue", bins=30) + geom_density(colour = "goldenrod1", size = 1)
p2 <- ggplot(train, aes(x=1)) + geom_boxplot(aes(y=price), colour = "navy", fill = "steelblue")
grid.arrange(p1, p2, nrow=1)
summary(train$price)
#Librerias
library(tidyr)
library(date)
library(zoo)
#library(tidyverse)
library(ggplot2)
library(corrplot)
library(caret)
library(dplyr)
library(olsrr)
library(fastDummies)
library(pracma)
library(geosphere)
library(readxl)
library(glmnet)
library(readr)
library(naniar)
library(gridExtra)
library(grid)
library(lattice)
library(GGally)
#Cargamos los datos y definimos una muestra train y otra test
train <- as.data.frame(read.csv(file = "C:/Users/Juanjo/Desktop/MasterDataScience/Practica/Pull1/house_king_county/train.csv"))
#test<-data[-dt,]
summary(train)
str(train)
var_cuant <- train[, c(3, 6, 20, 7, 21, 13, 14, 15, 16)]
str(var_cuant)
p1 <- ggplot(train, aes(x=price)) + geom_histogram(aes(y=..density..), colour = "navy", fill = "steelblue", bins=30) + geom_density(colour = "goldenrod1", size = 1)
p2 <- ggplot(train, aes(x=1)) + geom_boxplot(aes(y=price), colour = "navy", fill = "steelblue")
grid.arrange(p1, p2, nrow=1)
summary(train$price)
p3 <- ggplot(train, aes(x=sqft_living)) + geom_histogram(aes(y=..density..), colour = "navy", fill = "steelblue", bins=30) + geom_density(colour = "goldenrod1", size = 1)
p4 <- ggplot(train, aes(x=1)) + geom_boxplot(aes(y=sqft_living), colour = "navy", fill = "steelblue")
grid.arrange(p3, p4, nrow=1)
summary(train$sqft_living)
p5 <- ggplot(train, aes(x=sqft_living15)) + geom_histogram(aes(y=..density..), colour = "navy", fill = "steelblue", bins=30) + geom_density(colour = "goldenrod1", size = 1)
p6 <- ggplot(train, aes(x=1)) + geom_boxplot(aes(y=sqft_living15), colour = "navy", fill = "steelblue")
grid.arrange(p5, p6, nrow=1)
summary(train$sqft_living15)
var_cual <- train[, c(2, 4, 5, 8, 9 ,10 , 11, 12, 17)]
str(var_cual)
train$date <- gsub("T000000","",as.character(train$date))
train$date <- as.Date(train[, 'date'],'%Y%m%d')
#str(train$date)
df_dateMonth <- format(train$date,"%m")
df_dateYear <- format(train$date,"%Y")
df_dateMix <- data.frame(df_dateMonth, df_dateYear)
df_date2014 <- subset(df_dateMix, df_dateYear == 2014)
df_date2015 <- subset(df_dateMix, df_dateYear == 2015)
p1 <- ggplot(df_dateMix, aes(x=df_dateYear)) + geom_bar(colour = "navy", fill = "steelblue")
p2 <- ggplot(df_date2014, aes(x=df_dateMonth)) + geom_bar(colour = "navy", fill = "steelblue")
p3 <- ggplot(df_date2015, aes(x=df_dateMonth)) + geom_bar(colour = "navy", fill = "steelblue")
grid.arrange(p1, p2, p3, nrow=1)
summary(train$date)
p1 <- ggplot(train, aes(x=bedrooms)) + geom_bar(colour = "navy", fill = "steelblue")
p2 <- ggplot(train, aes(x=bathrooms)) + geom_bar(colour = "navy", fill = "steelblue")
p3 <- ggplot(train, aes(x=floors)) + geom_bar(colour = "navy", fill = "steelblue")
grid.arrange(p1, p2, p3, nrow=1)
train$sale_date = substr(train$date, 1, 8)
train = transform(train, sale_date = as.Date(as.character(sale_date), "%Y%m%d"))
train$sale_year = as.numeric(format(train$sale_date, format="%Y"))
train$sale_month = format(train$sale_date, format="%m")
train$sale_quarter = as.yearqtr(train$sale_date)
#train$sale_quarter = str_sub(train$sale_quarter,-2,-1)
train$sale_tenure =  as.numeric(train$sale_year) - train$yr_built
train$yr_since_last_renovated = ifelse(train$sale_year - train$yr_renovated > 2013, 0, train$sale_year - train$yr_renovated)
train$price_m2 = train$price/train$sqft_living
str(train)
am_cuant <- train %>% select("price","Dist_from_seattle","price_m2", "sqft_living","sqft_lot", "sqft_above", "sqft_basement", "yr_built", "yr_renovated", "lat", "long", "sqft_living15", "sqft_lot15")
amc1 <- c("sqft_living", "sqft_lot", "sqft_living15", "sqft_basement", "sqft_above","price","price_m2","Dist_from_seattle")
amc2 <- c("yr_built", "yr_renovated", "price")
#Correlación numérica entre variables
corr <- am_cuant %>% na.omit() %>% cor()
#Correlaciones importantes
as.data.frame(as.table(corr)) %>% subset(., abs(Freq) > 0.4) %>% subset(., abs(Freq) != 1) %>% .[order(.$Freq, decreasing = TRUE),] %>%
.[c(seq(1, nrow(.), by=2)),]
am_cuant %>% select(amc1) %>%  ggpairs(columns = 1:6)
am_cuant1 <- am_cuant %>% select(amc1) %>% na.omit() %>% ggcorr()
grid.arrange(am_cuant1, nrow=1)
am_cual <- train %>% select("date","sale_date", "sale_year", "sale_month", "bedrooms", "bathrooms", "waterfront", "view", "condition", "grade", "zipcode")
am1 <- c("bedrooms", "bathrooms","condition","grade")
#Correlación numérica entre variables
corr <- am_cual %>% select(am1) %>% na.omit() %>% cor()
#Correlaciones importantes
as.data.frame(as.table(corr)) %>% subset(., abs(Freq) > 0.1) %>% subset(., abs(Freq) != 1) %>% .[order(.$Freq, decreasing = TRUE),] %>%
.[c(seq(1, nrow(.), by=2)),]
colSums(is.na(train))
colSums(train==0)
nrow(train)
sqft_compare <- train[, c(6, 13)]
#nrow(subset(sqft_compare, sqft_living == sqft_above))
train <- mutate(train, price_log10 <- log10(train$price))
train <- mutate(train, price_sqrt <- sqrt(train$price))
train <- mutate(train, price_inv <- 1/(train$price))
p1 <- ggplot(train, aes(x=price)) + geom_histogram(aes(y=..density..), colour = "navy", fill = "steelblue", bins=30) + geom_density(colour = "goldenrod1", size = 1)
p2 <- ggplot(train, aes(x=price_log10 <- log10(train$price))) + geom_histogram(aes(y=..density..), colour = "navy", fill = "steelblue", bins=30) + geom_density(colour = "goldenrod1", size = 1)
p3 <- ggplot(train, aes(x=price_sqrt <- sqrt(train$price))) + geom_histogram(aes(y=..density..), colour = "navy", fill = "steelblue", bins=30) + geom_density(colour = "goldenrod1", size = 1)
p4 <- ggplot(train, aes(x=price_inv <- 1/(train$price))) + geom_histogram(aes(y=..density..), colour = "navy", fill = "steelblue", bins=30) + geom_density(colour = "goldenrod1", size = 1)
grid.arrange(p1, p2, p3, p4, nrow=2)
qqnorm(train$price)
qqline(train$price)
qqnorm(train$price_log10 <- log10(train$price))
qqline(train$price_log10 <- log10(train$price))
#Tranfomación de variables
train$waterfront = as.factor(train$waterfront)
train$view = as.factor(train$view)
train$zipcode = as.factor(train$zipcode)
#Creamos una variable que mide la distnacia de cada casa a la venta con respecto al centro ecónomico de la ciudad: Seattle
seattle = c(-122.335167, 47.608013)
train = mutate(train, Dist_from_seattle=distHaversine(cbind(long, lat),seattle))
#POr otro lado, se calcula la distancia de cada casa con respecto al resto, agrupando después casas cercanas en clústers.
long= train$long
lat = train$lat
DataMat<-as.matrix(cbind(long, lat))
DataMat[is.na(DataMat)]<-0
my_data <- as_tibble(DataMat)
#my_data=my_data %>% slice(1:100)
my_data = as.data.frame(my_data)
#<-distm(my_data,my_data,fun=distHaversine)/1000
#hclustfunc <- function(x) hclust(x, method="complete")
#distfunc <- function(x) as.dist((1-cor(t(x)))/2)
#d <- distfunc(Dist_Mat)
#fit <- hclustfunc(d)
#my_data$Clusters<- cutree(fit, h=0.25)
#train = merge(x = train, y = my_data, by = c("lat", "long") , all.x = TRUE)
#train$Clusters = as.factor(train$Clusters)
#bwplot(Clusters~price, data = train, horizontal= TRUE)
#specify_decimal
specify_decimal <- function(x, k) format(round(x, k), nsmall=k)
#beautifying summary.lm
new_summary  <- function(lmcoef, digits) {
coefs <- as.data.frame(lmcoef)
coefs[] <- lapply(coefs, function(x) specify_decimal(x, digits))
coefs
}
#(train, file = "C:/Users/Moncef/Documents/house_king_county/train.csv")
#Convertimos las variables catageoricas en dummies para su uso en el modelo.
# train_v1<- dummy_cols(train, select_columns = c('waterfront','view','Clusters','sale_quarter'),remove_most_frequent_dummy = TRUE,
#                    remove_selected_columns = TRUE)
#
# train_v1$sqft_lot_log = log(train_v1$sqft_lot)
# train_v1$sqft_above_log = log(train_v1$sqft_above)
# train_v1$sqft_living_log = log(train_v1$sqft_living)
# train_v1$Dist_from_seattle_log = log(train_v1$Dist_from_seattle)
# #train_v1$yr_renovated_log = log(train_v1$yr_renovated)
# #train_v1$sale_tenure_log = log(train_v1$sale_tenure)
#
#
# #Incluimos en c() las variables que NO queremos usar en la regresión.
# train_v2 = dplyr::select(train_v1,-c(id,sale_tenure,yr_renovated,sqft_above,sqft_lot,sale_tenure,yr_renovated,sqft_living,Dist_from_seattle,price,date,zipcode,sqft_basement,lat,sqft_lot15,long,date,sale_date,
#                               sale_year,yr_built,sale_month,yr_since_last_renovated,sqft_living15))
#
# summarize(train_v2)
#
# model <- lm(log(price_m2) ~ ., data = train_v2)
# summary(model)
# new_summary(summary(model)$coefficients, 5)
#
# plot(model, 1)
# res <- resid(model)
# plot(fitted(model), res)
# plot(model, which=1, col=c("blue"))
# plot(model, 2)
#
# require(nortest)  # Se debe haber instalado nortest
# lillie.test(model$residuals)
#Analisis de variables candidatas
step_model <- stepAIC(model, trace = TRUE, direction= "both")
ggplot(train,aes(x=price_m2,y=Dist_from_seattle))
ggplot(train,aes(x=price_m2,y=Dist_from_seattle))+geom_bar()
ggplot(train,aes(x=price_m2,y=Dist_from_seattle))+geom_point()
ggplot(train,aes(x=price_m2,y=Dist_from_seattle))+geom_boxplot()
ggplot(train,aes(x=price_m2,y=Dist_from_seattle))+geom_smooth()
ggplot(train,aes(x=price_m2,y=Dist_from_seattle))+geom_point()+geom_smooth()
ggplot(train,aes(x=price_m2,y=Dist_from_seattle))+geom_point()+geom_smooth(method="auto", se=TRUE, fullrange=FALSE, level=0.95)
ggplot(train,aes(x=price_m2,y=Dist_from_seattle, shape=cyl))+geom_point()
ggplot(train,aes(x=price_m2,y=Dist_from_seattle, shape=bathrooms))+geom_point()
ggplot(train,aes(x=price_m2,y=Dist_from_seattle))+geom_point()+geom_smooth()
ggplot(train,aes(x=price_m2,y=Dist_from_seattle))+geom_histogram()+geom_smooth()
ggplot(train,aes(x=price_m2,y=Dist_from_seattle))+geom_point()+geom_smooth()
ggplot(train,aes(x=sqft_living15,y=Dist_from_seattle))+geom_point()+geom_smooth()
ggplot(train,aes(x=Dist_from_seattle,y=sqft_living15))+geom_point()+geom_smooth()
ggplot(train,aes(x=sqft_living15,y=Dist_from_seattle))+geom_point()+geom_smooth()
ggplot(train,aes(x=Dist_from_seattle,y=price_m2))+geom_point()+geom_smooth()
am_cuant %>% select(amc1) %>%  ggpairs(columns = 1:9)
am_cuant %>% select(amc1) %>%  ggpairs(columns = 1:8)
am_cuant %>% select(amc1) %>%  ggpairs(columns = 0:8)
am_cuant %>% select(amc1) %>%  ggpairs(columns = 0:7)
am_cuant %>% select(amc1) %>%  ggpairs(columns = 1:8)
am_cuant <- train %>% select("price","Dist_from_seattle","price_m2", "sqft_living","sqft_lot", "sqft_above", "sqft_basement", "yr_built", "yr_renovated", "sqft_living15", "sqft_lot15")
amc1 <- c("sqft_living", "sqft_lot", "sqft_living15", "sqft_basement", "sqft_above","price","price_m2","Dist_from_seattle")
amc2 <- c("yr_built", "yr_renovated", "price")
#Correlación numérica entre variables
corr <- am_cuant %>% na.omit() %>% cor()
#Correlaciones importantes
as.data.frame(as.table(corr)) %>% subset(., abs(Freq) > 0.4) %>% subset(., abs(Freq) != 1) %>% .[order(.$Freq, decreasing = TRUE),] %>%
.[c(seq(1, nrow(.), by=2)),]
ggplot(train,aes(x=Dist_from_seattle,y=price))+geom_point()+geom_smooth()
wssplot <- function(data, nc=15, seed=1234){
wss <- (nrow(train)-1)*sum(apply(train,2,Clusters))
for (i in 2:nc){
set.seed(seed)
wss[i] <- sum(kmeans(train, centers=i)$withinss)}
plot(1:nc, wss, type="b", xlab="Number of Clusters",
ylab="Within groups sum of squares")}
wssplot(wine.stand, nc=6)
ggplot(train,aes(x=Clusters,y=price))+geom_point()+geom_smooth()
ggplot(train,aes(x=Clusters,y=price))+geom_boxplot()
ggplot(train,aes(x=Clusters,y=price))+geom_point()
ggplot(train,aes(x=Clusters,y=price_m2))+geom_point()
ggplot(train,aes(x=Clusters,y=price_m2))+geom_point()
plot(train&Clusters)
ggplot(train,aes(x=Clusters,y=price_m2))+geom_point()
plot(Clusters)
ggplot(train,aes(x=Clusters,y=price))+geom_point()
am_cual1 <- am_cuanl %>% select(am1) %>% na.omit() %>% ggcorr()
am_cual1 <- am_cual %>% select(am1) %>% na.omit() %>% ggcorr()
grid.arrange(am_cuanl1, nrow=1)
am_cual1 <- am_cual %>% select(am1) %>% na.omit() %>% ggcorr()
grid.arrange(am_cual1, nrow=1)
precio <- as.matrix(train&lat, train&long)
precio <- matrix(train&lat, train&long)
ggplot(train, aes(x=lat,y=long))
ggplot(train, aes(x=lat,y=long))+scale_fill_gradient()
ggplot(train, aes(x=lat,y=long))+scale_fill_gradient(bajo ="blanco",alto="rojo")
ggplot(train, aes(x=lat,y=long))+geometric_tile(aes(price_m2)+scale_fill_gradient(bajo ="blanco",alto="rojo")
ggplot(train, aes(x=lat,y=long))+geometric_tile(aes(price_m2))+scale_fill_gradient(bajo ="blanco",alto="rojo")
ggplot(train, aes(x=lat,y=long))+geom_tile(aes(price_m2))+scale_fill_gradient(bajo ="blanco",alto="rojo")
ggplot(train, aes(x=lat,y=long))+geom_tile(aes(price_m2))+scale_fill_gradient()
ggplot(train, aes(x=lat,y=long))+geom_tile(aes(price_m2), color="blanco")+scale_fill_gradient()
ggplot(train, aes(x=lat,y=long))+geom_tile(aes(price_m2))+scale_fill_gradient()
ggplot(train, aes(x=lat,y=long))+geom_point+scale_fill_gradient()
ggplot(train, aes(x=lat,y=long))+geom_point()+scale_fill_gradient()
ggplot(train, aes(x=long,y=lat))+geom_point()+scale_fill_gradient()
ggplot(train, aes(x=long,y=lat))+geom_point(price)+scale_fill_gradient()
ggplot(train, aes(x=long,y=lat))+geom_point()+scale_fill_gradient()
ggplot(train, aes(x=long,y=lat, fill=price_m2))+geom_point()+scale_fill_gradient()
ggplot(train, aes(x=long,y=lat, fill=price_m2))+geom_tile()+scale_fill_gradient()
ggplot(train, aes(x=long,y=lat, fill=price))+geom_tile()+scale_fill_gradient()
ggplot(train, aes(x=long,y=lat, fill=price))+geom_area()+scale_fill_gradient()
ggplot(train, aes(x=long,y=lat, fill=price))+geom_point()+scale_fill_gradient()
ggplot(train, aes(x=long,y=lat, fill=price))+geom_raster()
ggplot(train, aes(x=long,y=lat, fill=price))+geom_raster()+scale_x_continuous(NULL, expand = c(0, 0)) +
scale_y_continuous(NULL, expand = c(0, 0)) +
theme(legend.position = "none")
ggplot(train, aes(x=long,y=lat, fill=price))+geom_raster()+scale_fill_viridis_c()
ggplot(train, aes(x=long,y=lat, fill=price))+geom_raster()+scico::scale_fill_scico(palette = "bilbao")
ggplot(train, aes(x=long,y=lat, fill=price))+geom_raster(aes(colour=price))
bwplot(Clusters~price, data=train, horizontal=TRUE)
old = "bedrooms"
new = "cat_bedrooms"
price_tplusc[[new]] = cut2(price_tplusc[[old]], g=4)
install.packages("cut2")
old = "bedrooms"
new = "cat_bedrooms"
price_tplusc[[new]] = cut2(price_tplusc[[old]], g=4)
old = "bedrooms"
new = "cat_bedrooms"
price_tplusc[[new]] = cut(price_tplusc[[old]], g=4)
old = "bedrooms"
new = "cat_bedrooms"
price_tplusc[] = cut(price_tplusc[[old]], g=4)
old = "bedrooms"
new = "cat_bedrooms"
price_tplusc[] = cut(price[[old]], g=4)
ggplot(am_cual, aes(bathrooms, grade, fill(price_m2))) + geom_point(size = 4, alpha = .2, stroke = 0)
ggplot(am_cual, aes(bathrooms, grade, fill(price_m2))) + geom_point(size = 4, alpha = .2, stroke = 0)+guides(colour = guide_legend())
ggplot(am_cual, aes(bathrooms, grade, fill(price_m2))) + geom_point(size = 4, alpha = .2, stroke = 0) + guides(colour = guide_legend(override.aes = list(alpha = 1)))
ggplot(am_cual, aes(bathrooms, grade, fill(price_m2), colour=drv)) + geom_point(size = 4, alpha = .2, stroke = 0) + guides(colour = guide_legend(override.aes = list(alpha = 1)))
ggplot(am_cual, aes(bathrooms, grade, fill(price_m2))) + geom_point(size = 4, alpha = .2, stroke = 0) + guides(colour = guide_legend(override.aes = list(alpha = 1)))
ggplot(am_cual, aes(bathrooms, bedrooms, fill(price_m2))) + geom_point(size = 4, alpha = .2, stroke = 0) + guides(colour = guide_legend(override.aes = list(alpha = 1)))
ggplot(am_cual, aes(bathrooms, bedrooms, fill(price))) + geom_point(size = 4, alpha = .2, stroke = 0) + guides(colour = guide_legend(override.aes = list(alpha = 1)))
ggplot(am_cual, aes(bathrooms, bedrooms, fill(price))) + geom_point(aes(colour=txt),size=3)
install.packages("ggplot2")
install.packages("ggplot2")
install.packages("ggplot2")
#Librerias
library(tidyr)
library(date)
library(zoo)
#library(tidyverse)
library(ggplot2)
library(corrplot)
library(caret)
library(dplyr)
library(olsrr)
#Librerias
library(tidyr)
library(date)
library(zoo)
#library(tidyverse)
library(ggplot2)
library(corrplot)
library(caret)
library(dplyr)
library(olsrr)
library(fastDummies)
library(pracma)
library(geosphere)
library(readxl)
library(glmnet)
library(readr)
library(naniar)
library(gridExtra)
library(grid)
library(lattice)
library(GGally)
ggplot(am_cual, aes(bathrooms, bedrooms, fill(price))) + geom_point(aes(colour=txt),size=3)
ggplot(am_cual, aes(bathrooms, bedrooms, fill(price))) + geom_point(size = 4, alpha = .2, stroke = 0) + guides(colour = guide_legend(override.aes = list(alpha = 1)))
